<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bluevoir Camera Capture</title>
    <style>
      body {
        font-family: 'Arial', sans-serif;
        margin:0;
        background:#3B3B3B;
      }

      #bluevoir-permission-denied-container {
        display: none;
      }

      #bluevoir-video {
        width: 100%;
        height: 100%;
      }

      #bluevoir-video-box {
        position: absolute;
        width: 22.5vw;
        height: 31.5vw;
        border-radius: 50%;
        background: transparent;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        border: 1px dashed lightgray;
        overflow: hidden;
        left: 50%;
        top: 40%;
        transform: translate(-50%, -50%);
      }

      #bluevoir-camera-container {
        position: relative;
      }

      #bluevoir-capture-container {
        position: absolute;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        top:82%;
        left: 50%;
        transform: translateX(-50%);
      }

      #bluevoir-capture-btn {
        width: 4vw;
        height: 4vw;
        border-radius: 50%;
        border: 1px dashed #359e7b;
        background-color: #359e7b;
        cursor: pointer;
      }

      #bluevoir-camera-container,
      #bluevoir-captured-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0vh auto !important;
        border-radius: 0 !important;
      }

      #bluevoir-captured-image-container img {
        max-width: 100%;
        max-height: 100%;
      }

      #bluevoir-confirm-container,
      #bluevoir-retake-container {
        display: inline-block;
      }

      #bluevoir-capture-container span, #bluevoir-confirm-container span,
      #bluevoir-retake-container span {
        color: #ffffff;
        margin-top: 0.7vh;
        font-size: 1vw;
        z-index: 999;
        font-weight:500
      }

      #bluevoir-confirm-container {
        position: absolute;
        left: 55%;
        bottom: 2vh;
        transform: translateX(-55%);
        display:flex;
        justify-content:center;
      }

      #bluevoir-confirm-btn {
        position: absolute;
        width: 4vw;
        height: 4vw;
        border-radius: 50%;
        border: 1px dashed #39c24a;
        bottom: 4vh;
        background-color: #39c24a;
        cursor: pointer;
      }

      #bluevoir-retake-container {
        position: absolute;
        left: 45%;
        bottom: 2vh;
        transform: translateX(-45%);
        display:flex;
        justify-content:center;
      }

      #bluevoir-retake-btn {
        position: absolute;
        width: 4vw;
        height: 4vw;
        border-radius: 50%;
        border: 1px dashed #d5552f;
        bottom: 4vh;
        background-color: #d5552f;
        text-align:center;
        cursor: pointer;
      }


      @media only screen and (max-width: 992px) {
        #bluevoir-camera-container,
        #bluevoir-captured-image-container {
          position: relative;
          width: 100%;
          height: 100%;
          overflow: hidden;
          display: flex;
          flex-direction: row;
          justify-content: center;
          align-items: center;
        }
      
        #bluevoir-video-box {
          width: 35vw;
          height: 50vw;
        }
      
        #bluevoir-capture-container {
          position: absolute;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          top: 100vh;
          left: 50%;
          gap: 2vh;
        }
      
        #bluevoir-capture-container #bluevoir-capture-btn {
          position: absolute;
          width: 5vw;
          height: 5vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 15vh;
          background-color: #359e7b;
          cursor: pointer;
        }
      
        #bluevoir-confirm-container #bluevoir-confirm-btn {
          position: absolute;
          width: 5vw;
          height: 5vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 1vh;
          background-color: #39c24a;
          cursor: pointer;
        }
      
        #bluevoir-confirm-container {
          position: absolute;
          left: 35%;
          bottom: 4vh;
        }
      
        #bluevoir-retake-container {
          position: absolute;
          left: 45%;
          bottom: 4vh;
        }
      
        #bluevoir-retake-container #bluevoir-retake-btn {
          position: absolute;
          width: 5vw;
          height: 5vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 1vh;
          background-color: #d5552f;
          cursor: pointer;
        }
      
        #bluevoir-capture-container span {
          position: absolute;
          color: white !important;
          text-align: center;
          font-size: 2vw;
          bottom: 8vh;
        }
      
        #bluevoir-confirm-container span {
          position: absolute;
          color: black;
          margin-top: 5vh;
          text-align: center;
          font-size: 1.5vw;
        }
      
        #bluevoir-retake-container span {
          position: absolute;
          color: black;
          margin-top: 5vh;
          text-align: center;
          font-size: 1.5vw;
        }
      
        #bluevoir-captured-image-container img {
          max-width: 100%;
          max-height: 100%;
          margin-top: 0;
        }
      }
      
      @media only screen and (max-width: 575px) {
        #bluevoir-camera-container,
        #bluevoir-captured-image-container {
          position: relative;
          width: 100%;
          height: 80%;
          overflow: hidden;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          margin: 5vh auto !important;
        }
      
        #bluevoir-video {
          width: 100vw;
          height: 100vh;
        }
      
        #bluevoir-video-box {
          position: absolute;
          width: 48vw;
          height: 68vw;
          border-radius: 50%;
          background: transparent;
          box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
          border: 1px dashed lightgray;
          overflow: hidden;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
        }
      
        #bluevoir-capture-container {
          position: absolute;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          top: 100vh;
          left: 50%;
          z-index: 9999;
        }
      
        #bluevoir-capture-container #bluevoir-capture-btn {
          position: absolute;
          width: 10vw;
          height: 10vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 15vh;
          background-color: #359e7b;
          cursor: pointer;
        }
      
        #bluevoir-confirm-container #bluevoir-confirm-btn {
          position: absolute;
          width: 8vw;
          height: 8vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 4vh;
          background-color: #39c24a;
          cursor: pointer;
        }
      
        #bluevoir-confirm-container {
          position: absolute;
          left: 40%;
          bottom: 2vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          gap: 2vh;
        }
      
        #bluevoir-retake-container {
          position: absolute;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          left: 60%;
          bottom: 2vh;
        }
      
        #bluevoir-retake-container #bluevoir-retake-btn {
          position: absolute;
          width: 8vw;
          height: 8vw;
          border-radius: 50%;
          border: 1px dashed #000000;
          bottom: 4vh;
          background-color: #d5552f;
          cursor: pointer;
        }
      
        #bluevoir-capture-container span {
          position: absolute;
          margin-top: 5vh;
          color: white;
          text-align: center;
          font-size: 3.8vw;
          z-index: 9999;
          bottom: 8vh;
        }
      
        #bluevoir-confirm-container span {
          position: absolute;
          color: #fff;
          margin-top: 1vh;
          text-align: center;
          font-size: 3.5vw;
          margin-left: -6vw !important;
          bottom: -3vh;
        }
      
        #bluevoir-retake-container span {
          color: #fff;
          margin-top: 1vh;
          text-align: center;
          font-size: 3.5vw;
          margin-left: -4vw;
          bottom: -3vh;
        }
      
        #bluevoir-captured-image-container img {
          max-width: 100%;
          max-height: 100%;
        }
      }
      </style>
    </head>
    <body>
      <section id="bluevoir-permission-denied-container">
        <p>Camera access denied.</p>
        <p>
          To enable camera access, please go to your browser settings and allow
          camera access for this site.
        </p>
     
      </section>
  
      <main id="bluevoir-parent-camera-container">
        <section id="bluevoir-camera-container">
          <video id="bluevoir-video" autoplay></video>
          <div id="bluevoir-capture-container">
            <button id="bluevoir-capture-btn"></button>
            <span>Capture</span>
          </div>
        </section>
  
        <section
          id="bluevoir-captured-image-container"
          style="display: none; text-align: center"
        >
          <img id="bluevoir-captured-image" src="" alt="Captured Image" />
            <div id="bluevoir-retake-container">
              <button id="bluevoir-retake-btn"></button>
              <span>Retake</span>
            </div>
          <div id="bluevoir-confirm-container">
            <button id="bluevoir-confirm-btn"></button>
            <span>Confirm</span>
          </div>
       
        </section>
      </main>
  
      <script>
        const bluevoirCameraCaptureModule = (function () {

          let bluevoirVideoContainer,
            bluevoirVideo,
            bluevoirCaptureBtn,
            bluevoirCapturedImageContainer,
            bluevoirCapturedImage,
            bluevoirConfirmBtn,
            bluevoirRetakeBtn,
            bluevoirPermissionDeniedContainer,
            bluevoirParentCameraContainer,
            bluevoirStream,
            bluevoirConfirmAction;
  
          const bluevoirOverlayHTML = '<div id="bluevoir-video-box"></div>';
  
          let bluevoirShowOverlay = true;
          let bluevoirOverlayColor = "rgb(0,0,0,0.5)";
  
          function bluevoirGetElements() {
            bluevoirVideoContainer = document.getElementById("bluevoir-camera-container");
            bluevoirVideo = document.getElementById("bluevoir-video");
            bluevoirCaptureBtn = document.getElementById("bluevoir-capture-btn");
            bluevoirCapturedImageContainer = document.getElementById(
              "bluevoir-captured-image-container"
            );
            bluevoirCapturedImage = document.getElementById("bluevoir-captured-image");
            bluevoirConfirmBtn = document.getElementById("bluevoir-confirm-btn");
            bluevoirRetakeBtn = document.getElementById("bluevoir-retake-btn");
            bluevoirPermissionDeniedContainer = document.getElementById(
              "bluevoir-permission-denied-container"
            );
            bluevoirParentCameraContainer = document.getElementById(
              "bluevoir-parent-camera-container"
            );
          }
  
          async function bluevoirStartCamera() {
            try {
              bluevoirStream = await navigator.mediaDevices.getUserMedia({ video: true });
              bluevoirVideo.srcObject = bluevoirStream;
              if (bluevoirPermissionDeniedContainer.style.display === "block") {
                bluevoirPermissionDeniedContainer.style.display = "none";
              }
              if (bluevoirParentCameraContainer.style.display === "none") {
                bluevoirParentCameraContainer.style.display = "block";
              }
            } catch (bluevoirError) {
              console.error("Error accessing camera:", bluevoirError);
              bluevoirPermissionDeniedContainer.style.display = "block";
              bluevoirParentCameraContainer.style.display = "none";
            }
          }
  
          function bluevoirCaptureImage(bluevoirEvent) {
            bluevoirEvent.preventDefault();
            const bluevoirCanvas = document.createElement("canvas");
            bluevoirCanvas.width = bluevoirVideo.videoWidth;
            bluevoirCanvas.height = bluevoirVideo.videoHeight;
            bluevoirCanvas.getContext("2d").drawImage(bluevoirVideo, 0, 0);
            const bluevoirImageData = bluevoirCanvas.toDataURL("image/png");
            bluevoirCapturedImage.src = bluevoirImageData;
            bluevoirVideoContainer.style.display = "none";
            bluevoirCapturedImageContainer.style.display = "block";
            bluevoirStopCamera();
          }
  
          function bluevoirRetakePicture(bluevoirEvent) {
            bluevoirEvent.preventDefault();
            bluevoirStartCamera();
            bluevoirVideoContainer.style.display = "block";
            bluevoirCapturedImageContainer.style.display = "none";
          }
  
          function bluevoirStopCamera() {
            if (bluevoirStream) {
              const bluevoirTracks = bluevoirStream.getTracks();
              bluevoirTracks.forEach((bluevoirTrack) => bluevoirTrack.stop());
            }
          }
  
          function bluevoirUpdateOverlay() {
            const bluevoirOverlay = document.getElementById("bluevoir-video-box");
            if (bluevoirShowOverlay) {
              if (!bluevoirOverlay) {
                bluevoirVideoContainer.insertAdjacentHTML("afterbegin", bluevoirOverlayHTML);
              }
              const bluevoirNewOverlay = document.getElementById("bluevoir-video-box");
              if (bluevoirNewOverlay) {
                bluevoirNewOverlay.style.boxShadow = `0 0 0 1000px ${bluevoirOverlayColor}`;
              }
            } else {
              if (bluevoirOverlay) {
                bluevoirOverlay.remove();
              }
            }
          }
  
          function bluevoirHandleConfirm(bluevoirEvent) {
            bluevoirEvent.preventDefault();
            if (bluevoirCapturedImage.src) {
              bluevoirCopyBase64ImageToClipboard(bluevoirCapturedImage.src);
              alert('Image is copied successfully to clipboard')
            }
            if (
              bluevoirConfirmAction != undefined &&
              bluevoirConfirmAction != null &&
              bluevoirCapturedImage != null
            ) {
              bluevoirConfirmAction(bluevoirCapturedImage.src);
            }
          }
  
          async function bluevoirCopyBase64ImageToClipboard(bluevoirBase64Image) {
            try {
              const bluevoirResponse = await fetch(bluevoirBase64Image);
              console.log(bluevoirResponse, "response");
              const bluevoirBlob = await bluevoirResponse.blob();
  
              await navigator.clipboard.write([
                new ClipboardItem({
                  [bluevoirBlob.type]: bluevoirBlob,
                }),
              ]);
              console.log("Base64 image copied to clipboard!");
            } catch (bluevoirErr) {
              console.error("Failed to copy base64 image: ", bluevoirErr);
            }
          }
  
          function bluevoirInit(bluevoirCustomConfirmAction = function(){}, bluevoirOverlayOptions = {display:true}) {
            window.addEventListener("beforeunload", bluevoirStopCamera);
            bluevoirGetElements();
            bluevoirCaptureBtn.addEventListener("click", bluevoirCaptureImage);
            bluevoirConfirmBtn.addEventListener("click", bluevoirHandleConfirm);
            bluevoirRetakeBtn.addEventListener("click", bluevoirRetakePicture);
            bluevoirStartCamera();
            bluevoirConfirmAction = bluevoirCustomConfirmAction;
  
            if (bluevoirOverlayOptions != null) {
              bluevoirShowOverlay =
                bluevoirOverlayOptions.display != null ? bluevoirOverlayOptions.display : true;
              bluevoirOverlayColor = bluevoirOverlayOptions.color || "rgba(0,0,0,0.5)";
            }
            bluevoirUpdateOverlay();
            window.addEventListener("load", bluevoirUpdateOverlay);
          }
  
          // Public functions and properties
          return {
            initialize: bluevoirInit,
            startCamera: bluevoirStartCamera,
            stopCamera: bluevoirStopCamera,
            retake: bluevoirRetakePicture,
          };
        })();
  
        // Usage
        bluevoirCameraCaptureModule.initialize();
      </script>
    </body>
  </html>