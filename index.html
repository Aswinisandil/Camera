<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Camera Capture</title>
    <style>

@media (min-width: 993px){
      #camera-container,
      #captured-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin: 0vh auto !important;
        border-radius: 0;
      }

      #video {
        width: 100vw;
        height: 100vh;
      }

      #video-box {
        position: absolute;
        width: 26vw;
        height: 32vw;
        border-radius: 50%;
        background: transparent;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        border: 1px dashed lightgray;
        overflow: hidden;
        left: 50%;
        top: 45%;
        transform: translate(-50%, -50%);
      }

      #capture-btn {
        position: absolute;
        width: 5vw;
        height: 5vw;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 10vh;
        background-color: #359e7b;
        cursor: pointer;
        left: 42%;
      }

      #capture-btn2 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #359e7b;
        cursor: pointer;
        left: 66%;
        z-index: 9999;
      }

      #confirm-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #39c24a;
        cursor: pointer;
      }

      #retake-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #d5552f;
        cursor: pointer;
      }

      #capture-btn h6{
        color: white;
        margin-top: 10vh;
        text-align: center;
        font-size: 1vw;
      }


      #confirm-btn h6,
      #retake-btn h6 {
        color: black;
        margin-top: 8vh;
        text-align: center;
        font-size: 1vw;
      }

      #controls-container {
        position: absolute;
        top: 85%;
        left: 50%;
        width: 5vw;
      }

      #controls-container h6{
        color: white;
        margin-top: 2vh;
        text-align: center;
        font-size: 1vw;
        width: 9vw;
      }

      input[type="color" i] {
        appearance: auto;
        inline-size: 5vw;
        block-size: 4vh;
        cursor: default;
        box-sizing: border-box;
        background-color: buttonface;
        color: buttontext;
        border-width: 0.1vw;
        border-style: solid;
        border-color: buttonborder;
        border-image: initial;
        padding: 0.1vh 0.2vw ;
        margin-top: 0.3vh;
        margin-left: 2vw;
      }

      #captured-image-container img {
        max-width: 100%;
        max-height: 100%;
       
      }

    }

      @media (min-width: 797px) and (max-width: 992px) {
        #camera-container,
      #captured-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin: 5vh auto !important;
      }

      #video {
        width: 100vw;
        height: 100vh;
      }

      #video-box {
        position: absolute;
        width: 32vw;
        height: 45vw;
        border-radius: 50%;
        background: transparent;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        border: 1px dashed lightgray;
        overflow: hidden;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      #capture-btn {
        position: absolute;
        width: 9vw;
        height: 9vw;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 15vh;
        background-color: #359e7b;
        cursor: pointer;
        left: 36%;
      }

      #capture-btn2 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #359e7b;
        cursor: pointer;
        left: 66%;
        z-index: 9999;
      }

      #confirm-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #39c24a;
        cursor: pointer;
      }

      #retake-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #d5552f;
        cursor: pointer;
      }

      #capture-btn h6{
        color: white;
        margin-top: 8vh;
        text-align: center;
        font-size: 2.8vw;
        margin-left: -1.5vw;
      }


      #confirm-btn h6,
      #retake-btn h6 {
        color: black;
        margin-top: 8vh;
        text-align: center;
        font-size: 1vw;
      }

      #controls-container {
        position: absolute;
        top: 80%;
        left: 50%;
        width: 5vw;
      }

      #controls-container h6{
        color: white;
        margin-top: 3vh;
        text-align: center;
        font-size: 2.5vw;
        width: 18vw;
        font-family: 'Arial';
        font-weight: 900;
      }

      input[type="color" i] {
        appearance: auto;
        inline-size: 10vw;
        block-size: 4vh;
        cursor: default;
        box-sizing: border-box;
        background-color: buttonface;
        color: buttontext;
        border-width: 0.1vw;
        border-style: solid;
        border-color: buttonborder;
        border-image: initial;
        padding: 0.1vh 0.7vw ;
      }

      #captured-image-container img {
        max-width: 100%;
        max-height: 100%;
       
      }
 

    @media only screen and (max-width: 768px) {
      #camera-container,
      #captured-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin: 5vh auto !important;
      }

      #video {
        width: 100vw;
        height: 100vh;
      }

      #video-box {
        position: absolute;
        width: 50vw;
        height: 75vw;
        border-radius: 50%;
        background: transparent;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        border: 1px dashed lightgray;
        overflow: hidden;
        left: 50%;
        top: 40%;
        transform: translate(-50%, -50%);
      }

      #capture-btn {
        position: absolute;
        width: 5vw;
        height: 5vw;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 5vh;
        background-color: #359e7b;
        cursor: pointer;
        left: 40%;
      }

      #capture-btn2 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #359e7b;
        cursor: pointer;
        left: 66%;
        z-index: 9999;
      }

      #confirm-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #39c24a;
        cursor: pointer;
      }

      #retake-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #d5552f;
        cursor: pointer;
      }

      #capture-btn h6{
        color: white;
        margin-top: 10vh;
        text-align: center;
        font-size: 1vw;
      }


      #confirm-btn h6,
      #retake-btn h6 {
        color: black;
        margin-top: 8vh;
        text-align: center;
        font-size: 1vw;
      }

      #controls-container {
        position: absolute;
        top: 85%;
        left: 50%;
        width: 5vw;
      }

      input[type="color" i] {
        appearance: auto;
        inline-size: 5vw;
        block-size: 4vh;
        cursor: default;
        box-sizing: border-box;
        background-color: buttonface;
        color: buttontext;
        border-width: 0.1vw;
        border-style: solid;
        border-color: buttonborder;
        border-image: initial;
        padding: 0.1vh 0.2vw ;
      }

      #captured-image-container img {
        max-width: 100%;
        max-height: 100%;
       
      }
     }

     @media only screen and (max-width: 575px){
      #camera-container,
      #captured-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin: 5vh auto !important;
      }

      #video {
        width: 100vw;
        height: 100vh;
      }

      #video-box {
        position: absolute;
        width: 60vw;
        height: 80vw;
        border-radius: 50%;
        background: transparent;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        border: 1px dashed lightgray;
        overflow: hidden;
        left: 50%;
        top: 40%;
        transform: translate(-50%, -50%);
      }

      #capture-btn {
        position: absolute;
        width: 10vw;
        height: 10vw;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 5vh;
        background-color: #359e7b;
        cursor: pointer;
        left: 40%;
      }

      #capture-btn2 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #359e7b;
        cursor: pointer;
        left: 66%;
        z-index: 9999;
      }

      #confirm-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #39c24a;
        cursor: pointer;
      }

      #retake-btn {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px dashed #000000;
        bottom: 40px;
        background-color: #d5552f;
        cursor: pointer;
      }

      #capture-btn h6{
        color: white;
        margin-top: 10vh;
        text-align: center;
        font-size: 1vw;
      }


      #confirm-btn h6,
      #retake-btn h6 {
        color: black;
        margin-top: 8vh;
        text-align: center;
        font-size: 1vw;
      }

      #controls-container {
        position: absolute;
        top: 85%;
        left: 50%;
        width: 5vw;
      }

      input[type="color" i] {
        appearance: auto;
        inline-size: 5vw;
        block-size: 4vh;
        cursor: default;
        box-sizing: border-box;
        background-color: buttonface;
        color: buttontext;
        border-width: 0.1vw;
        border-style: solid;
        border-color: buttonborder;
        border-image: initial;
        padding: 0.1vh 0.2vw ;
      }

      #captured-image-container img {
        max-width: 100%;
        max-height: 100%;
       
      }
     }


      }
    </style>
  </head>
  <body>
    <div>
      <div id="camera-container">
        <video id="video" autoplay></video>
        <!-- <div id="video-box"></div> -->
        <button id="capture-btn"><h6>Capture</h6></button>
        <div id="controls-container">
          <input type="color" id="overlay-color" value="#000000" />
          <h6>Overlay Color</h6>
        </div>
      </div>
      <div id="captured-image-container" style="display: none">
        <img id="captured-image" src="" alt="Captured Image" />
        <div style="position: absolute; left: 20%; bottom: 10px">
          <button id="confirm-btn"><h6>Confirm</h6></button>
        </div>
        <div style="position: absolute; left: 30%; bottom: 10px">
          <button id="retake-btn"><h6>Retake</h6></button>
        </div>
      </div>
      <div id="permission-denied-container" style="display: none">
        <p>Camera access denied.</p>
        <p>
          To enable camera access, please go to your browser settings and allow
          camera access for this site.
        </p>
      </div>
    </div>

   <script>
    const CameraCaptureModule = (function () {
  // Private variables and functions
  let videoContainer,
    video,
    captureBtn,
    capturedImageContainer,
    capturedImage,
    confirmBtn,
    retakeBtn, 
    permissionDeniedContainer,
    stream;

    const overlayHTML = '<div id="video-box"></div>';

    let showOverlay = true;

  function getElements() {
    videoContainer = document.getElementById("camera-container");
    video = document.getElementById("video");
    captureBtn = document.getElementById("capture-btn");
    capturedImageContainer = document.getElementById(
      "captured-image-container"
    );
    capturedImage = document.getElementById("captured-image");
    confirmBtn = document.getElementById("confirm-btn");
    retakeBtn = document.getElementById("retake-btn");
    permissionDeniedContainer = document.getElementById(
      "permission-denied-container"
    );
    overlayColorPicker = document.getElementById("overlay-color");

  }

  async function startCamera() {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    } catch (error) {
      console.error("Error accessing camera:", error);
      permissionDeniedContainer.style.display = "block";
    }
  }

  function captureImage(event) {  
    event.preventDefault();
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    const imageData = canvas.toDataURL("image/png");
    capturedImage.src = imageData;
    videoContainer.style.display = "none";
    capturedImageContainer.style.display = "block";
    stopCamera();
  }

  function retakePicture(event) {
    event.preventDefault();
    startCamera();
    videoContainer.style.display = "block";
    capturedImageContainer.style.display = "none";
  }

  function stopCamera() {
    if (stream) {
      const tracks = stream.getTracks();
      tracks.forEach((track) => track.stop());
    }
  }

  function updateOverlay() {
    if (showOverlay) {
      videoContainer.insertAdjacentHTML("afterbegin", overlayHTML);
    } else {
      const overlay = document.getElementById("video-box");
      if (overlay) {
        overlay.remove();
      }
    }
  }

  function updateOverlayColor() {
    const selectedColor = overlayColorPicker.value;
    const overlay = document.getElementById("video-box");
    if (overlay) {
      overlay.style.boxShadow = `0 0 0 1000px rgba(${parseInt(
        selectedColor.slice(1, 3),
        16
      )}, ${parseInt(selectedColor.slice(3, 5), 16)}, ${parseInt(
        selectedColor.slice(5, 7),
        16
      )}, 0.5)`;
    }
  }


  function handleConfirm() {
    alert("success");
  }

  // Public functions and properties
  return {
    init: function () {
      getElements();
      captureBtn.addEventListener("click", captureImage);
      confirmBtn.addEventListener("click", handleConfirm);
      retakeBtn.addEventListener("click", retakePicture);
      startCamera();
      window.addEventListener("beforeunload", stopCamera);
        // Call the updateOverlay function initially
        updateOverlay();
      window.addEventListener("load", updateOverlayColor);
      overlayColorPicker.addEventListener("input", updateOverlayColor);
    },
  };
})();

// Usage
CameraCaptureModule.init();
   </script>
  </body>
</html>
